<!DOCTYPE html>
<html>
<head>
    <!-- Google Tag Manager -->
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
    'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-54M6JKXS');</script>
    <!-- End Google Tag Manager -->
    <title>Home - Yojit Acharya</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta charset="UTF-8" />
    
    <link rel="stylesheet" href="style.css">

    <script>
        // Global image loading state management
        window.imageLoadingState = {
            loadedImages: new Set(),
            failedImages: new Set(),
            retryAttempts: new Map()
        };

        // Robust image preloader with better error handling
        function preloadImages() {
            const imageUrls = [
                'Imgs/Chameleon.png',
                'Imgs/Tetris.png', 
                'Imgs/snake.png',
                'Chess/Chess_Pieces/N.png',
                'Imgs/blackjack.png',
                'Imgs/Wordle.png',
                'Imgs/BlockBlast.png',
                'Imgs/Sudoku.png'
            ];

            const preloadPromises = imageUrls.map(url => {
                return new Promise((resolve, reject) => {
                    const img = new Image();
                    
                    img.onload = () => {
                        window.imageLoadingState.loadedImages.add(url);
                        console.log(`üì¶ Preloaded: ${url}`);
                        resolve(url);
                    };
                    
                    img.onerror = () => {
                        window.imageLoadingState.failedImages.add(url);
                        console.warn(`‚ö†Ô∏è Preload failed: ${url}`);
                        // Don't reject - we'll handle this later
                        resolve(url);
                    };
                    
                    // Set a timeout for very slow loading
                    setTimeout(() => {
                        if (!window.imageLoadingState.loadedImages.has(url)) {
                            console.warn(`‚è±Ô∏è Preload timeout: ${url}`);
                            resolve(url);
                        }
                    }, 5000);
                    
                    img.src = url;
                });
            });

            return Promise.all(preloadPromises);
        }

        // Enhanced image loader with multiple fallback strategies
        function loadImageWithFallbacks(imgElement) {
            const originalSrc = imgElement.getAttribute('src') || imgElement.dataset.src;
            if (!originalSrc) return;

            const maxRetries = 3;
            let currentAttempt = window.imageLoadingState.retryAttempts.get(originalSrc) || 0;
            
            // Skip if already loaded successfully
            if (window.imageLoadingState.loadedImages.has(originalSrc)) {
                imgElement.src = originalSrc;
                imgElement.classList.add('loaded');
                return;
            }

            imgElement.classList.add('loading');
            console.log(`üîÑ Loading image: ${originalSrc} (attempt ${currentAttempt + 1})`);

            function tryLoad(src, attempt = 0) {
                const tempImg = new Image();
                
                tempImg.onload = function() {
                    imgElement.src = this.src;
                    imgElement.classList.remove('loading');
                    imgElement.classList.add('loaded');
                    window.imageLoadingState.loadedImages.add(originalSrc);
                    console.log(`‚úÖ Successfully loaded: ${this.src}`);
                };

                tempImg.onerror = function() {
                    console.error(`‚ùå Failed to load: ${this.src} (attempt ${attempt + 1})`);
                    
                    if (attempt < maxRetries) {
                        window.imageLoadingState.retryAttempts.set(originalSrc, attempt + 1);
                        
                        // Progressive fallback strategies
                        setTimeout(() => {
                            let fallbackSrc = originalSrc;
                            
                            switch(attempt + 1) {
                                case 1:
                                    // Try with cache buster
                                    fallbackSrc = `${originalSrc}?v=${Date.now()}`;
                                    break;
                                case 2:
                                    // Try different case
                                    fallbackSrc = originalSrc.replace('Imgs/', 'imgs/');
                                    break;
                                case 3:
                                    // Try different extension
                                    fallbackSrc = originalSrc.replace('.png', '.jpg').replace('.jpg', '.png');
                                    break;
                            }
                            
                            console.log(`üîÑ Retry ${attempt + 1}: ${fallbackSrc}`);
                            tryLoad(fallbackSrc, attempt + 1);
                        }, Math.pow(2, attempt) * 1000); // Exponential backoff
                    } else {
                        // All attempts failed
                        imgElement.classList.remove('loading');
                        window.imageLoadingState.failedImages.add(originalSrc);
                        console.error(`üí• All attempts failed for: ${originalSrc}`);
                        
                        // Set fallback styling
                        imgElement.style.background = 'linear-gradient(45deg, rgba(255, 69, 69, 0.2), rgba(255, 105, 180, 0.2))';
                        imgElement.alt = `Image failed to load`;
                        
                        // Add retry button overlay
                        const retryButton = document.createElement('div');
                        retryButton.innerHTML = 'üîÑ';
                        retryButton.style.cssText = `
                            position: absolute;
                            top: 50%;
                            left: 50%;
                            transform: translate(-50%, -50%);
                            background: rgba(64, 224, 208, 0.8);
                            border-radius: 50%;
                            width: 30px;
                            height: 30px;
                            display: flex;
                            align-items: center;
                            justify-content: center;
                            cursor: pointer;
                            z-index: 10;
                        `;
                        retryButton.onclick = () => {
                            retryButton.remove();
                            window.imageLoadingState.retryAttempts.delete(originalSrc);
                            loadImageWithFallbacks(imgElement);
                        };
                        
                        imgElement.parentElement.style.position = 'relative';
                        imgElement.parentElement.appendChild(retryButton);
                    }
                };

                // Critical: Set source last to trigger loading
                tempImg.src = src;
            }

            tryLoad(originalSrc, currentAttempt);
        }

        // Wait for DOM and ensure everything is ready
        function initializeWhenReady() {
            const headerElement = document.querySelector('header');
            const navListItems = document.querySelectorAll('nav li');
            const mainElement = document.querySelector('main');
            const figureElements = document.querySelectorAll('.games figure');
            const imageElements = document.querySelectorAll('.games img');

            console.log(`üöÄ Found ${imageElements.length} images to load`);

            // Start preloading images immediately
            preloadImages().then(() => {
                console.log('üì¶ Preloading phase complete');
                
                // Load images with staggered timing to prevent overwhelming
                imageElements.forEach((img, index) => {
                    setTimeout(() => {
                        loadImageWithFallbacks(img);
                    }, index * 100); // Stagger by 100ms each
                });
            });

            // Staggered UI animations - only start after images begin loading
            setTimeout(() => {
                headerElement.classList.add('slide-in');
            }, 200);

            setTimeout(() => {
                navListItems.forEach(item => item.classList.add('slide-in'));
            }, 600);

            setTimeout(() => {
                mainElement.classList.add('slide-in');
            }, 1000);

            setTimeout(() => {
                figureElements.forEach((item, index) => {
                    setTimeout(() => {
                        item.classList.add('slide-in');
                    }, index * 150);
                });
            }, 1400);

            // Add interactive hover effects
            figureElements.forEach(figure => {
                figure.addEventListener('mouseenter', function() {
                    this.style.transform = 'translateY(-10px) scale(1.02)';
                });
                
                figure.addEventListener('mouseleave', function() {
                    this.style.transform = 'translateY(0) scale(1)';
                });
            });
        }

        // Multiple initialization strategies to handle different loading states
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initializeWhenReady);
        } else if (document.readyState === 'interactive' || document.readyState === 'complete') {
            // DOM already loaded
            initializeWhenReady();
        }

        // Fallback: Also try when window fully loads
        window.addEventListener('load', () => {
            // Double-check any images that might have failed
            const stillLoadingImages = document.querySelectorAll('.games img.loading');
            if (stillLoadingImages.length > 0) {
                console.log(`üîÑ Window loaded, retrying ${stillLoadingImages.length} failed images`);
                stillLoadingImages.forEach(img => {
                    img.classList.remove('loading');
                    loadImageWithFallbacks(img);
                });
            }
        });

        // Handle visibility change (when user switches tabs)
        document.addEventListener('visibilitychange', () => {
            if (!document.hidden) {
                // Page became visible again - retry any failed images
                const failedImages = document.querySelectorAll('.games img:not(.loaded):not(.loading)');
                if (failedImages.length > 0) {
                    console.log(`üëÅÔ∏è Page visible again, retrying ${failedImages.length} failed images`);
                    failedImages.forEach(img => loadImageWithFallbacks(img));
                }
            }
        });
    </script>
</head>
<body>
    <!-- Google Tag Manager (noscript) -->
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-54M6JKXS"
    height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <!-- End Google Tag Manager (noscript) -->
    <header>
        <nav>
            <ul>
                <li><a href="index.html">Home</a></li>
                <li><a href="portfolio.html">Portfolio</a></li>
                <li><a href="test.html">Test</a></li>
            </ul>
        </nav>
    </header>
    <main>
        <h2> NEW! </h2>
        <h3> Do you need tutoring for the ACT, AP classes, or anything in school?
            <br>
            Are you interested in honing your teaching and communication skills through tutoring?
            <br>
         Click <a href="Tutoring/index.html">HERE</a> to learn more about tutoring </h3>
            <br>
            <h2> Current Works </h2>
            <div class ="games">
                <figure>
                    <a href="Chameleon/public/index.html">
                        <img src="Imgs/Chameleon.png" alt="Chameleon game screenshot" loading="eager">
                    </a>
                    <figcaption><a href="Chameleon/public/index.html">Chameleon (Multiplayer)</a></figcaption>
                </figure>
            </div>
        <h2>Apps & Projects</h2>
        <div class="games">
            <figure>
                <a href="Tetris/index.html">
                    <img src="Imgs/Tetris.png" alt="Tetris game screenshot" loading="eager">
                </a>
                <figcaption><a href="Tetris/index.html">Tetris</a></figcaption>
            </figure>

            <figure>
                <a href="Snake/index.html">
                    <img src="Imgs/snake.png" alt="Snake game screenshot" loading="eager">
                </a>
                <figcaption><a href="Snake/index.html">Snake</a></figcaption>
            </figure>
            
            <figure>
               <a href="Chess/index.html">
                   <img src="Chess/Chess_Pieces/N.png" alt="Chess knight piece" loading="eager">
               </a>
                <figcaption><a href="Chess/index.html">Chess</a></figcaption>
            </figure>
        </div>
        <div class="games">
            <figure>
                <a href="Blackjack/index.html">
                    <img src="Imgs/blackjack.png" alt="Blackjack game screenshot" loading="eager">
                </a>
                <figcaption><a href="Blackjack/index.html">Blackjack</a></figcaption>
            </figure>
            
            <figure>
                <a href="Wordle/index.html">
                    <img src="Imgs/Wordle.png" alt="Wordle game screenshot" loading="eager">
                </a>
                <figcaption><a href="Wordle/index.html">Wordle</a></figcaption>
            </figure>
            
            <figure>
                <a href="BlockBlast/index.html">
                    <img src="Imgs/BlockBlast.png" alt="Block Blast game screenshot" loading="eager">
                </a>
                <figcaption><a href="BlockBlast/index.html">Block Blast</a></figcaption>
            </figure>
        </div>

        <div class="games">
            <figure>
                <a href="Sudoku/index.html">
                    <img src="Imgs/Sudoku.png" alt="Sudoku game screenshot" loading="eager">
                </a>
                <figcaption><a href="Sudoku/index.html">Sudoku</a></figcaption>
            </figure>
        </div>
    </main>
</body>
</html>